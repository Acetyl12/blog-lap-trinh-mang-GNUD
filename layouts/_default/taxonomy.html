{{ define "main" }}

<section class="container mx-auto p-6">
  <header class="mb-6">
    <h1 class="text-3xl font-extrabold">#{{ .Title }}</h1>
    <p class="opacity-80 mt-1">{{ len .Pages }} bài viết</p>
  </header>

  {{ $p := .Paginate (.Pages.ByDate.Reverse) }}

  <div class="grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3">
    {{ range $p.Pages }}
      {{ $cover := .Resources.GetMatch "cover*" }}
      <article class="group rounded-xl overflow-hidden border border-neutral-200 dark:border-neutral-800 bg-white/70 dark:bg-neutral-900/70 hover:shadow-xl hover:-translate-y-0.5 transition">
        {{ if $cover }}
          <a href="{{ .RelPermalink }}"><img src="{{ $cover.RelPermalink }}" alt="{{ .Title }}" class="w-full h-44 object-cover"></a>
        {{ else if .Params.cover }}
          <a href="{{ .RelPermalink }}"><img src="{{ .Params.cover | relURL }}" alt="{{ .Title }}" class="w-full h-44 object-cover"></a>
        {{ else }}
          <div class="w-full h-44 bg-gradient-to-br from-neutral-200/70 to-neutral-300/70 dark:from-neutral-800 dark:to-neutral-700"></div>
        {{ end }}

        <div class="p-4">
          <h2 class="text-lg font-semibold leading-snug">
            <a href="{{ .RelPermalink }}" class="group-hover:underline decoration-2 underline-offset-4">{{ .Title }}</a>
          </h2>
          <p class="text-sm opacity-70 mt-1">{{ .Date.Format "2006-01-02" }} • ~{{ .ReadingTime }} phút</p>

          {{ $sum := cond (ne .Summary "") (.Summary | plainify) (.Plain | truncate 180) }}
          <p class="opacity-90 mt-2 clamp-3">{{ $sum }}</p>

          <div class="mt-3 flex flex-wrap gap-2">
            {{ with .Params.categories }}
              {{ range first 1 . }}
                {{ $c := . }}
                {{ with $.Site.GetPage (printf "/categories/%s" ($c | urlize)) }}
                  <a href="{{ .RelPermalink }}" class="px-2 py-1 text-xs rounded-full bg-neutral-100 dark:bg-neutral-800">{{ $c }}</a>
                {{ end }}
              {{ end }}
            {{ end }}
            {{ with .Params.tags }}
              {{ range first 3 . }}
                {{ $t := . }}
                {{ with $.Site.GetPage (printf "/tags/%s" ($t | urlize)) }}
                  <a href="{{ .RelPermalink }}" class="px-2 py-1 text-xs rounded-full bg-neutral-100 dark:bg-neutral-800">#{{ $t }}</a>
                {{ end }}
              {{ end }}
            {{ end }}
          </div>
        </div>
      </article>
    {{ end }}
  </div>

  {{ if gt $p.TotalPages 1 }}
  <nav class="flex justify-center items-center gap-2 mt-10">
    {{ with $p.Prev }}
      <a class="px-3 py-2 rounded border border-neutral-200 dark:border-neutral-700 hover:bg-neutral-100 dark:hover:bg-neutral-800" href="{{ .URL }}">← Mới hơn</a>
    {{ end }}
    {{ range $i, $pg := $p.Pagers }}
      {{ $n := add $i 1 }}
      <a href="{{ $pg.URL }}"
         class="px-3 py-2 rounded border border-neutral-200 dark:border-neutral-700 hover:bg-neutral-100 dark:hover:bg-neutral-800 {{ if eq $pg $p }}bg-neutral-900 text-white dark:bg-white dark:text-black{{ end }}">
        {{ $n }}
      </a>
    {{ end }}
    {{ with $p.Next }}
      <a class="px-3 py-2 rounded border border-neutral-200 dark:border-neutral-700 hover:bg-neutral-100 dark:hover:bg-neutral-800" href="{{ .URL }}">Cũ hơn →</a>
    {{ end }}
  </nav>
  {{ end }}
</section>

{{ end }}
